---
title: 高德地图
date:  2019-07-15 10:42:04
tags:
---

#### 结合checkbox打点生成不同的masker图标

- html 
 
    <el-form ref="form" :model="form">
        <el-form-item>
            <div class="menu">
                <el-checkbox v-model="form.kakou" @change="handleCheck('kakou', '01')"></el-checkbox>
                <span>卡口</span>
            </div>
            <div class="menu">
                <el-checkbox v-model="form.dianjing" @change="handleCheck('dianjing', '02')"></el-checkbox>
                <span>电警</span>
            </div>
        </el-form-item>
    </el-form>

- js
  
    在vue data中定义form 复选框checkbox 的命名和图标img保持一致

            form: {
                    kakou: false,
                    dianjing: false
                },

    定义点位数组

            pointData: {
                kakou: [],
                dianjing: []
            },

            removeData: {   //masker数组 方便清空
                kakou: {markers:[],cluster:null},
                dianjing: {markers:[],cluster:null}
            },

    在methods中定义复选框选中的方法

            handleCheck : function (image, vlaue) {
                if (this.form[image]) {
                    this.loading = this.$loading({ //loading
                        lock: true,
                        text: '生成点位中',
                        spinner: 'el-icon-loading',
                        background: 'rgba(0, 0, 0, 0.7)'
                    });
                    this.getData(image, vlaue); //请求接口 或者对应的点位经纬度
                } else {
                    //删除点位图标
                    this.toggleRemoveSpecifiedMarker(this.pointData[image], image); 
                    if(this.removeData[image].cluster){
                        this.removeData[image].cluster.clearMarkers(this.removeData[image]);
                    }
                    this.removeData[image].cluster = null;
                }
            },
    
    请求点位数据

          getData : function (type, value) {  //value 在html中定义不同的数字区分
            var that = this;
            that.sendAjax('POST', 'xxxxxxx‘, {'value': value}, function (res) {
                    if (res && res.result) {
                        that.pointData[type] = [];  //每次进入都为空
                        for (var i = 0; i< res.result.length; i++) {  //遍历追加点位坐标
                            that.pointData[type].push({  
                                x: res.result[i].JD,
                                y: res.result[i].WD
                            })
                        }
                        that.toggleAddMarker(that.pointData[type], type);
                    }
                });
            },

    添加点位标记 地图打点（高德API 第三章 图层类 这个只是打点标记 无信息窗体）

          toggleAddMarker : function (pointdata, image) {
            if(commonMaps.map){
                var opts=new IMAP.MarkerOptions();
                opts.anchor = IMAP.Constants.BOTTOM_CENTER;
                //图标路径拼接
                opts.icon=new IMAP.Icon("image/"+ image +"_1.png",{"size":new IMAP.Size(35, 30)}); 
                for (var i = 0; i< pointdata.length; i++) {
                    var point = pointdata[i];  //点位数据
                    var lnglat=new IMAP.LngLat(point.x, point.y);
                    if(lnglat){
                        marker=new IMAP.Marker(lnglat, opts);
                        commonMaps.map.getOverlayLayer().addOverlay(marker);
                        this.removeData[image].markers.push(marker);
                    }
                }
                this.loading.close();
            }
        },

  没有选中 则删除点标记

        toggleRemoveSpecifiedMarker : function (pointdata, image) {
            if (commonMaps.map) {
                commonMaps.map.getOverlayLayer().clear(this.removeData[image].markers);
                this.removeData[image].markers = [];
            }
        }

#### 区域  添加多边形图层

- 添加数组

         var commonMaps = new (window.commonMap)();// 实例化地图方法
        commonMaps.areaContent = [];  //行政区域图层     

- 点击每一行时 拿到点位数组

             var pointArr = eval(this.currentRowData.points);
             if(pointArr.length>0){
                        //添加对应区域的多边形图层
                        commonMaps.addArea([pointArr],{  
                            id: "zidingyiAreaConternt",
                        });
                         //添加对应区域的多边形图层的中心点图标
                        commonMaps.addMarkers([this.currentRowData],"centerx","centery",{
                            src: "../common/image/point2.gif",
                            width: "47px",
                            height: "55px",
                            markerName: "zidingyiGifMarkerCotent"
                        });
                        commonMaps.changeMapCenter(this.currentRowData.centerx,this.currentRowData.centery,14);
                    };

